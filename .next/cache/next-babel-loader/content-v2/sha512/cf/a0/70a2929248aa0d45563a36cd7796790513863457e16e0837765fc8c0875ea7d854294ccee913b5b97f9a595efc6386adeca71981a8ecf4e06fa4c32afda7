{"ast":null,"code":"const {\n  MongoClient\n} = require('mongodb');\n\nconst consoleString = \"\\u001b[1;32m [Database] \\u001b[0m \";\nexport default async function searchDatabase(hashVal) {\n  const uri = \"mongodb+srv://nhacker:nhacker12.@cluster0.eubpg.mongodb.net/myFirstDatabase?retryWrites=true&w=majority\";\n  const client = new MongoClient(uri);\n\n  try {\n    await client.connect();\n    const res = await verifyUser(client, {\n      name: hashVal\n    });\n    return res;\n  } catch (e) {\n    console.error(e);\n  } finally {\n    await client.close();\n  }\n}\n\nasync function verifyUser(client, potentialUser) {\n  const alreadyExists = await findOneListingByName(client, potentialUser.name);\n\n  if (alreadyExists) {\n    console.log(`${consoleString} user already exists`);\n    return false;\n  } else {\n    await createListing(client, potentialUser);\n    console.log(`${consoleString} added new user`);\n    return true;\n  }\n}\n\nasync function findOneListingByName(client, nameOfUser) {\n  const result = await client.db(\"id_verification\").collection(\"verified_users\").findOne({\n    name: nameOfUser\n  });\n\n  if (result) {\n    console.log(`${consoleString} Found a listing in the collection with name ${nameOfUser}`);\n    console.log(`${consoleString} ${result}`);\n    return true;\n  } else {\n    console.log(`${consoleString} No listings with name ${nameOfUser}`);\n    return false;\n  }\n}\n\nasync function createListing(client, new_user) {\n  const result = await client.db(\"id_verification\").collection(\"verified_users\").insertOne(new_user);\n  console.log(`${consoleString} new listing created with id: ${result.insertedId}`);\n}","map":{"version":3,"sources":["/Users/neilhacker/Desktop/working_on/ostrom_id_copy_5/backend/mongo.js"],"names":["MongoClient","require","consoleString","searchDatabase","hashVal","uri","client","connect","res","verifyUser","name","e","console","error","close","potentialUser","alreadyExists","findOneListingByName","log","createListing","nameOfUser","result","db","collection","findOne","new_user","insertOne","insertedId"],"mappings":"AAAA,MAAM;AAACA,EAAAA;AAAD,IAAiBC,OAAO,CAAC,SAAD,CAA9B;;AACA,MAAMC,aAAa,GAAG,oCAAtB;AAEA,eAAe,eAAeC,cAAf,CAA8BC,OAA9B,EAAuC;AAElD,QAAMC,GAAG,GAAG,yGAAZ;AAEA,QAAMC,MAAM,GAAG,IAAIN,WAAJ,CAAgBK,GAAhB,CAAf;;AAEA,MAAI;AACA,UAAMC,MAAM,CAACC,OAAP,EAAN;AAEA,UAAMC,GAAG,GAAG,MAAMC,UAAU,CAACH,MAAD,EAAQ;AAChCI,MAAAA,IAAI,EAAEN;AAD0B,KAAR,CAA5B;AAIA,WAAOI,GAAP;AAEH,GATD,CASE,OAAOG,CAAP,EAAU;AACRC,IAAAA,OAAO,CAACC,KAAR,CAAcF,CAAd;AACH,GAXD,SAWU;AACN,UAAML,MAAM,CAACQ,KAAP,EAAN;AACH;AAEJ;;AAID,eAAeL,UAAf,CAA0BH,MAA1B,EAAkCS,aAAlC,EAAiD;AAC7C,QAAMC,aAAa,GAAG,MAAMC,oBAAoB,CAACX,MAAD,EAASS,aAAa,CAACL,IAAvB,CAAhD;;AACA,MAAIM,aAAJ,EAAmB;AACfJ,IAAAA,OAAO,CAACM,GAAR,CAAa,GAAEhB,aAAc,sBAA7B;AACA,WAAO,KAAP;AACH,GAHD,MAGO;AACH,UAAMiB,aAAa,CAACb,MAAD,EAASS,aAAT,CAAnB;AACAH,IAAAA,OAAO,CAACM,GAAR,CAAa,GAAEhB,aAAc,iBAA7B;AACA,WAAO,IAAP;AACH;AAEJ;;AAED,eAAee,oBAAf,CAAoCX,MAApC,EAA4Cc,UAA5C,EAAwD;AACpD,QAAMC,MAAM,GAAG,MAAMf,MAAM,CAACgB,EAAP,CAAU,iBAAV,EAA6BC,UAA7B,CAAwC,gBAAxC,EAA0DC,OAA1D,CAAkE;AAACd,IAAAA,IAAI,EAAEU;AAAP,GAAlE,CAArB;;AAEA,MAAGC,MAAH,EAAW;AACPT,IAAAA,OAAO,CAACM,GAAR,CAAa,GAAEhB,aAAc,gDAA+CkB,UAAW,EAAvF;AACAR,IAAAA,OAAO,CAACM,GAAR,CAAa,GAAEhB,aAAc,IAAGmB,MAAO,EAAvC;AACA,WAAO,IAAP;AACH,GAJD,MAIO;AACHT,IAAAA,OAAO,CAACM,GAAR,CAAa,GAAEhB,aAAc,0BAAyBkB,UAAW,EAAjE;AACA,WAAO,KAAP;AACH;AACJ;;AAED,eAAeD,aAAf,CAA6Bb,MAA7B,EAAqCmB,QAArC,EAA+C;AAC5C,QAAMJ,MAAM,GAAG,MAAMf,MAAM,CAACgB,EAAP,CAAU,iBAAV,EAA6BC,UAA7B,CAAwC,gBAAxC,EAA0DG,SAA1D,CAAoED,QAApE,CAArB;AAEAb,EAAAA,OAAO,CAACM,GAAR,CAAa,GAAEhB,aAAc,iCAAgCmB,MAAM,CAACM,UAAW,EAA/E;AACF","sourcesContent":["const {MongoClient } = require('mongodb');\nconst consoleString = \"\\u001b[1;32m [Database] \\u001b[0m \";\n\nexport default async function searchDatabase(hashVal) {\n\n    const uri = \"mongodb+srv://nhacker:nhacker12.@cluster0.eubpg.mongodb.net/myFirstDatabase?retryWrites=true&w=majority\"\n\n    const client = new MongoClient(uri);\n\n    try {\n        await client.connect();\n\n        const res = await verifyUser(client,{\n            name: hashVal,\n        })\n        \n        return res\n\n    } catch (e) {\n        console.error(e);\n    } finally {\n        await client.close()\n    }\n\n}\n\n\n\nasync function verifyUser(client, potentialUser) {\n    const alreadyExists = await findOneListingByName(client, potentialUser.name );\n    if (alreadyExists) {\n        console.log(`${consoleString} user already exists`)\n        return false\n    } else {\n        await createListing(client, potentialUser)\n        console.log(`${consoleString} added new user`)\n        return true\n    }\n\n}\n\nasync function findOneListingByName(client, nameOfUser) {\n    const result = await client.db(\"id_verification\").collection(\"verified_users\").findOne({name: nameOfUser});\n\n    if(result) {\n        console.log(`${consoleString} Found a listing in the collection with name ${nameOfUser}`)\n        console.log(`${consoleString} ${result}`)\n        return true;\n    } else {\n        console.log(`${consoleString} No listings with name ${nameOfUser}`)\n        return false;\n    }\n}\n\nasync function createListing(client, new_user) {\n   const result = await client.db(\"id_verification\").collection(\"verified_users\").insertOne(new_user);\n\n   console.log(`${consoleString} new listing created with id: ${result.insertedId}`)\n}\n\n"]},"metadata":{},"sourceType":"module"}